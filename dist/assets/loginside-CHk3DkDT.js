import{k as I,j as e,b as o,m as J,q as V,z as U,F as _,p as v,x as w,A as c,y as h,H as E,I as G}from"./index-6iWKD2A3.js";import{I as g}from"./InputAdornment-CyCcCxfs.js";import{P as W}from"./Person-B4ybhAZ1.js";const P=I(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),K=I(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),Q=I(e.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),$=()=>{const[y,T]=o.useState({email:"",password:""}),[j,u]=o.useState("login"),[k,M]=o.useState(""),[S,q]=o.useState(""),[p,z]=o.useState({password:"",confirmPassword:""}),[m,x]=o.useState(!1),[l,n]=o.useState(""),[s,r]=o.useState({email:"",password:"",general:""}),[A,F]=o.useState(!1),R=J();o.useEffect(()=>{localStorage.getItem("token")&&R("/app/admin")},[R]);const f=a=>{const{name:i,value:d}=a.target;j==="login"?(T(t=>({...t,[i]:d})),r(t=>({...t,[i]:"",general:""}))):j==="requestReset"?(M(d),r(t=>({...t,general:""}))):j==="validateCode"?(q(d),r(t=>({...t,general:""}))):j==="resetPassword"&&(z(t=>({...t,[i]:d})),r(t=>({...t,general:""})))},O=()=>{F(a=>!a)},B=async()=>{const{email:a,password:i}=y;let d=!1;const t={email:"",password:"",general:""};if(a||(t.email="Veuillez entrer votre adresse email.",d=!0),i||(t.password="Veuillez entrer votre mot de passe.",d=!0),d){r(t);return}x(!0),r({email:"",password:"",general:""});try{const C=await fetch("https://cl-back.onrender.com/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}),b=await C.json();if(!C.ok){switch(b.errorCode){case"USER_NOT_FOUND":t.email="Aucun compte trouvé avec cet email.";break;case"INVALID_PASSWORD":t.password="Mot de passe incorrect.";break;default:t.general=b.message||"Identifiants invalides."}throw r(t),new Error(b.message||"Identifiants invalides")}localStorage.setItem("token",b.accessToken),n("Connexion réussie !"),setTimeout(()=>{R("/app/admin")},1e3)}catch(C){console.error("Erreur lors de la connexion :",C)}finally{x(!1)}},N=async()=>{if(!k){r({...s,general:"Veuillez entrer votre adresse email."});return}x(!0),r({email:"",password:"",general:""});try{const a=await fetch("https://cl-back.onrender.com/users/reset-password-request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:k})});if(!a.ok){const i=await a.json();throw new Error(i.message||"Erreur lors de la demande de réinitialisation.")}n("Un code de réinitialisation a été envoyé à votre email."),u("validateCode")}catch(a){r({...s,general:a.message})}finally{x(!1)}},L=()=>{if(!S){r({...s,general:"Veuillez entrer le code de réinitialisation."});return}u("resetPassword"),r({...s,general:""})},D=async()=>{if(!p.password||!p.confirmPassword){r({...s,general:"Veuillez remplir tous les champs."});return}if(p.password!==p.confirmPassword){r({...s,general:"Les mots de passe ne correspondent pas."});return}x(!0),r({email:"",password:"",general:""});try{const a=await fetch("https://cl-back.onrender.com/users/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resetCode:S,newPassword:p.password})});if(!a.ok){const i=await a.json();throw new Error(i.message||"Erreur lors de la réinitialisation du mot de passe.")}n("Mot de passe réinitialisé avec succès."),u("login")}catch(a){r({...s,general:a.message})}finally{x(!1)}},H=()=>{switch(j){case"login":return e.jsxs(e.Fragment,{children:[e.jsx(w,{label:"Adresse Email",name:"email",type:"email",variant:"outlined",fullWidth:!0,required:!0,value:y.email,onChange:f,autoFocus:!0,error:!!s.email,helperText:s.email,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(W,{})})}}),e.jsx(w,{label:"Mot de Passe",name:"password",type:A?"text":"password",variant:"outlined",fullWidth:!0,required:!0,value:y.password,onChange:f,error:!!s.password,helperText:s.password,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(P,{})}),endAdornment:e.jsx(g,{position:"end",children:e.jsx(G,{onClick:O,edge:"end","aria-label":"toggle password visibility",children:A?e.jsx(Q,{}):e.jsx(K,{})})})}}),e.jsx(v,{variant:"body2",color:"primary",sx:{cursor:"pointer",textAlign:"right"},onClick:()=>{u("requestReset"),r({email:"",password:"",general:""}),n("")},children:"Mot de passe oublié ?"}),s.general&&e.jsx(c,{severity:"error",onClose:()=>r({...s,general:""}),children:s.general}),l&&e.jsx(c,{severity:"success",onClose:()=>n(""),children:l}),e.jsx(h,{variant:"contained",color:"primary",onClick:B,disabled:m,fullWidth:!0,sx:{mt:2,padding:"12px",borderRadius:"8px",textTransform:"none",fontWeight:"bold",backgroundColor:"#333","&:hover":{backgroundColor:"#555"}},children:m?e.jsx(E,{size:24,color:"inherit"}):"Se connecter"})]});case"requestReset":return e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"h6",align:"center",gutterBottom:!0,children:"Demande de Réinitialisation"}),e.jsx(w,{label:"Adresse Email",type:"email",variant:"outlined",fullWidth:!0,required:!0,value:k,onChange:f,autoFocus:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(W,{})})}}),s.general&&e.jsx(c,{severity:"error",onClose:()=>r({...s,general:""}),children:s.general}),l&&e.jsx(c,{severity:"success",onClose:()=>n(""),children:l}),e.jsx(h,{variant:"contained",color:"primary",onClick:N,disabled:m,fullWidth:!0,sx:{mt:2},children:m?e.jsx(E,{size:24,color:"inherit"}):"Envoyer le code"}),e.jsx(h,{variant:"text",color:"primary",onClick:()=>{u("login"),r({email:"",password:"",general:""}),n("")},fullWidth:!0,sx:{mt:1},children:"Retour à la Connexion"})]});case"validateCode":return e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"h6",align:"center",gutterBottom:!0,children:"Validation du Code"}),e.jsx(w,{label:"Code de Réinitialisation",type:"text",variant:"outlined",fullWidth:!0,required:!0,value:S,onChange:f,autoFocus:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(P,{})})}}),s.general&&e.jsx(c,{severity:"error",onClose:()=>r({...s,general:""}),children:s.general}),l&&e.jsx(c,{severity:"success",onClose:()=>n(""),children:l}),e.jsx(h,{variant:"contained",color:"primary",onClick:L,disabled:m,fullWidth:!0,sx:{mt:2},children:"Valider le code"}),e.jsx(h,{variant:"text",color:"primary",onClick:()=>{u("login"),r({email:"",password:"",general:""}),n("")},fullWidth:!0,sx:{mt:1},children:"Retour à la Connexion"})]});case"resetPassword":return e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"h6",align:"center",gutterBottom:!0,children:"Réinitialiser le Mot de Passe"}),e.jsx(w,{label:"Nouveau Mot de Passe",name:"password",type:"password",variant:"outlined",fullWidth:!0,required:!0,value:p.password,onChange:f,autoFocus:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(P,{})})}}),e.jsx(w,{label:"Confirmer le Mot de Passe",name:"confirmPassword",type:"password",variant:"outlined",fullWidth:!0,required:!0,value:p.confirmPassword,onChange:f,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(P,{})})}}),s.general&&e.jsx(c,{severity:"error",onClose:()=>r({...s,general:""}),children:s.general}),l&&e.jsx(c,{severity:"success",onClose:()=>n(""),children:l}),e.jsx(h,{variant:"contained",color:"primary",onClick:D,disabled:m,fullWidth:!0,sx:{mt:2},children:m?e.jsx(E,{size:24,color:"inherit"}):"Réinitialiser le mot de passe"}),e.jsx(h,{variant:"text",color:"primary",onClick:()=>{u("login"),r({email:"",password:"",general:""}),n("")},fullWidth:!0,sx:{mt:1},children:"Retour à la Connexion"})]});default:return null}};return e.jsx(V,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:"#f5f5f5",padding:2,children:e.jsx(U,{sx:{maxWidth:400,width:"100%",padding:3,boxShadow:3},children:e.jsxs(_,{children:[e.jsx(v,{variant:"h5",component:"div",gutterBottom:!0,align:"center",children:"Connexion Admin"}),e.jsx(V,{component:"form",noValidate:!0,children:H()})]})})})};export{$ as default};
