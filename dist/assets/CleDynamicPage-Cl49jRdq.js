import{a3 as Y,m as J,b as t,a4 as Q,j as r,q as l,a5 as X,C as W,x as Z,p as i,G as D,z as ee,E as re,a6 as te,F as oe,y as j,a7 as ne,a8 as ae,Y as se,A as ce}from"./index-6iWKD2A3.js";import{D as ie,a as le}from"./DialogContent-BnRQpyZi.js";function de(o,c){const[p,g]=t.useState(o);return t.useEffect(()=>{const h=setTimeout(()=>g(o),c);return()=>clearTimeout(h)},[o,c]),p}const pe=()=>{const{brandFull:o}=Y(),c=J(),[p,g]=t.useState(""),h=de(p,300),[m,F]=t.useState([]),[z,f]=t.useState(!0),[S,k]=t.useState(null),[P,b]=t.useState(!1),[O,y]=t.useState(""),[q,v]=t.useState("success"),[E,w]=t.useState(null),[A,B]=t.useState(!1),[U,_]=t.useState(""),[H,M]=t.useState(1);t.useEffect(()=>{if(/^\d+-/.test(o)){const e=o.split("-");if(e.length>=3){const a=e[0],s=e.slice(2).join("-");c(`/produit/${a}/${encodeURIComponent(s)}`)}else c(`/produit/${encodeURIComponent(o)}`);return}},[o,c]);const R="_1_reproduction_cle.html",d=o.endsWith(R)?o.slice(0,-R.length):o,u=d.toUpperCase(),x=t.useCallback(e=>!e||e.trim()===""?"":e.startsWith("data:")||e.startsWith("http")?e:`https://cl-back.onrender.com/${e}`,[]);t.useEffect(()=>{/^\d+-/.test(o)||d&&fetch(`https://cl-back.onrender.com/brands/logo/${encodeURIComponent(d)}`).then(e=>{if(e.ok)return e.blob();throw new Error(`Logo non trouvé pour ${d}`)}).then(e=>{const a=URL.createObjectURL(e);w(a)}).catch(e=>{console.error("Erreur lors du chargement du logo:",e),w(null)})},[d,o]),t.useEffect(()=>{window.scrollTo(0,0)},[]),t.useEffect(()=>{if(/^\d+-/.test(o)){f(!1);return}if(!u){k("La marque n'a pas été fournie."),f(!1);return}f(!0),Q(u).then(e=>{F(e)}).catch(e=>{console.error("Erreur lors du chargement des clés:",e),k(e.message),y(`Erreur: ${e.message}`),v("error"),b(!0)}).finally(()=>f(!1))},[u,o]),t.useEffect(()=>{m.forEach(e=>{const a=new Image;a.src=x(e.imageUrl)})},[m,x]);const V=t.useCallback(e=>{g(e.target.value)},[]),T=t.useMemo(()=>m.filter(e=>e.nom.toLowerCase().includes(h.toLowerCase())).slice().reverse(),[m,h]),$=t.useCallback((e,a)=>{try{const s=e.nom.trim().replace(/\s+/g,"-");c(`/commander/${u.replace(/\s+/g,"-")}/cle/${e.referenceEbauche}/${encodeURIComponent(s)}?mode=${a}`)}catch(s){console.error("Erreur lors de la navigation vers la commande:",s),y(`Erreur lors de la commande: ${s.message}`),v("error"),b(!0)}},[u,c]),I=t.useCallback(e=>{const a=e.nom.trim().replace(/\s+/g,"-"),s=e.marque.trim().replace(/\s+/g,"-");c(`/produit/${s}/${encodeURIComponent(a)}`)},[c]),G=t.useCallback(e=>{_(x(e.imageUrl)),M(1),B(!0)},[x]),N=t.useCallback((e,a)=>{a!=="clickaway"&&b(!1)},[]),K=t.useCallback(e=>{e.preventDefault(),M(a=>{let s=a+(e.deltaY<0?.1:-.1);return s=Math.max(.5,Math.min(s,3)),s})},[]),n=t.useMemo(()=>({page:{backgroundColor:"#fafafa",minHeight:"100vh",paddingBottom:"24px"},searchContainer:{marginTop:{xs:"20px",sm:"40px"},marginBottom:"24px"},gridContainer:{padding:"16px 0"},card:{backgroundColor:"#fff",borderRadius:"12px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)",transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",height:"100%",minHeight:"400px",width:"100%",flex:1},cardMedia:{height:180,objectFit:"contain",backgroundColor:"#fff",borderTopLeftRadius:"12px",borderTopRightRadius:"12px"},cardContent:{flexGrow:1,padding:{xs:"8px",sm:"16px"},fontFamily:"Montserrat, sans-serif",textAlign:"left"},productName:{fontSize:"1.2rem",fontWeight:700,marginBottom:0,color:"#333",cursor:"pointer"},brandName:{fontSize:"0.9rem",color:"#777",marginBottom:"8px"},pricesContainer:{display:"flex",gap:"8px",marginTop:"12px"},priceBadge:{backgroundColor:"#e8f5e9",padding:"6px 12px",borderRadius:"8px",textAlign:"center",color:"#1B5E20"},buttonSecondary:{borderRadius:"50px",padding:"8px 16px",fontFamily:"Montserrat, sans-serif",textTransform:"none",fontWeight:600,fontSize:"0.75rem",boxShadow:"none",marginTop:"8px"},buttonContainer:{padding:{xs:"8px",sm:"16px"},display:"flex",flexDirection:"column",gap:"8px",mt:"auto"},brandLogoContainer:{position:"absolute",top:8,left:8,width:32,height:32,borderRadius:"50%",overflow:"hidden",backgroundColor:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",zIndex:2}}),[]);return r.jsxs(l,{sx:n.page,children:[r.jsx(X,{}),r.jsx(W,{sx:n.searchContainer,children:r.jsx(Z,{label:"Tapez le numéro de votre clé",variant:"outlined",fullWidth:!0,value:p,onChange:V})}),r.jsx(W,{maxWidth:"xl",children:z?r.jsx(i,{align:"center",sx:{fontFamily:"Montserrat, sans-serif"},children:"Chargement..."}):S?r.jsx(i,{align:"center",color:"error",sx:{fontFamily:"Montserrat, sans-serif"},children:S}):T.length>0?r.jsx(D,{container:!0,spacing:2,alignItems:"stretch",justifyContent:"center",sx:n.gridContainer,children:T.map((e,a)=>{const s=Number(e.prix),L=Number(e.prixSansCartePropriete);return r.jsx(D,{item:!0,xs:12,sm:6,md:4,lg:3,sx:{display:"flex"},children:r.jsxs(ee,{sx:n.card,children:[r.jsxs(l,{onClick:()=>G(e),sx:{cursor:"pointer",position:"relative"},children:[E&&r.jsx(l,{sx:n.brandLogoContainer,children:r.jsx("img",{src:E,alt:e.marque,style:{width:"100%",height:"100%",objectFit:"contain"},onError:C=>console.error(`Erreur de chargement du logo pour ${e.marque}:`,C)})}),r.jsx(re,{component:"img",image:x(e.imageUrl),alt:e.nom,sx:n.cardMedia,onError:C=>console.error("Erreur lors du chargement de l'image du produit:",C)}),r.jsx(te,{variant:"rectangular",sx:{position:"absolute",top:0,left:0,width:"100%",height:180,borderTopLeftRadius:"12px",borderTopRightRadius:"12px"}})]}),r.jsxs(oe,{sx:n.cardContent,children:[r.jsx(i,{sx:n.productName,onClick:()=>I(e),children:e.nom}),r.jsx(i,{sx:n.brandName,children:e.marque}),r.jsxs(l,{sx:n.pricesContainer,children:[s>0&&r.jsxs(l,{sx:n.priceBadge,children:[r.jsx(i,{variant:"caption",children:"Copie chez le fabricant"}),r.jsxs(i,{variant:"h6",sx:{fontWeight:700},children:[e.prix," €"]})]}),L>0&&r.jsxs(l,{sx:n.priceBadge,children:[r.jsx(i,{variant:"caption",children:"Copie dans nos atelier"}),r.jsxs(i,{variant:"h6",sx:{fontWeight:700},children:[e.prixSansCartePropriete," €"]})]})]})]}),r.jsxs(l,{sx:n.buttonContainer,children:[s>0&&r.jsxs(j,{variant:"outlined",onClick:()=>$(e,"numero"),startIcon:r.jsx(ne,{}),sx:{...n.buttonSecondary,borderColor:"#1B5E20",color:"#1B5E20","&:hover":{backgroundColor:"#1B5E20",color:"#fff"}},children:["Commander par numéro ",r.jsx("br",{}),"(chez le fabricant)"]}),L>0&&r.jsx(j,{variant:"outlined",onClick:()=>$(e,"postal"),startIcon:r.jsx(ae,{}),sx:{...n.buttonSecondary,borderColor:"#1B5E20",color:"#1B5E20","&:hover":{backgroundColor:"#1B5E20",color:"#fff"}},children:"Commander reproduction dans nos atelier"}),r.jsx(j,{variant:"text",onClick:()=>I(e),sx:{mt:1,textTransform:"none"},children:"Voir le produit"})]})]})},e.id||a)})}):r.jsx(i,{align:"center",sx:{fontFamily:"Montserrat, sans-serif"},children:"Aucune clé trouvée."})}),r.jsx(se,{open:P,autoHideDuration:6e3,onClose:N,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:r.jsx(ce,{onClose:N,severity:q,sx:{width:"100%",fontFamily:"Montserrat, sans-serif"},children:O})}),r.jsx(ie,{open:A,onClose:()=>B(!1),maxWidth:"lg",children:r.jsx(le,{children:r.jsx(l,{onWheel:K,sx:{display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",maxHeight:"80vh"},children:r.jsx("img",{src:U,alt:"Agrandissement de la clé",style:{transform:`scale(${H})`,transition:"transform 0.2s",width:"100%",height:"auto"}})})})})]})};export{pe as default};
