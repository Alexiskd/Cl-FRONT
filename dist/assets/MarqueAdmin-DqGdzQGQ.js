import{b as n,j as o,C as R,p as g,A as W,q as f,G as l,x as w,y as h,H as T,z as $,E as P,F as H}from"./index-6iWKD2A3.js";import{C as I}from"./CardActions-CEyLDF7y.js";function G(){return fetch("https://cl-back.onrender.com/brands").then(s=>{if(!s.ok)throw new Error("Erreur lors de la récupération des marques");return s.json()}).then(s=>s.map(a=>(a.logo&&!a.logo.startsWith("data:image/")&&(a.logo=`data:image/jpeg;base64,${a.logo}`),a)))}const V=()=>{const[s,c]=n.useState({nom:"",logoFile:null}),[a,D]=n.useState([]),[b,u]=n.useState(null),[p,i]=n.useState(!1),[C,x]=n.useState(null),[d,j]=n.useState(!1),[y,E]=n.useState(null),[v,F]=n.useState(""),S=()=>{i(!0),G().then(e=>{console.log("Marques récupérées :",e),D(e),i(!1)}).catch(e=>{x(e.message),i(!1)})};n.useEffect(()=>{S()},[]);const z=e=>{const{name:t,value:r}=e.target;c(m=>({...m,[t]:r}))},A=e=>{const t=e.target.files[0];if(t){console.log("Fichier sélectionné :",t);const r=new FileReader;r.onloadend=()=>{c(m=>({...m,logoFile:r.result})),u(r.result)},r.readAsDataURL(t)}},B=async e=>{if(e.preventDefault(),x(null),!s.nom||!s.logoFile&&!d){x("Veuillez renseigner le nom et sélectionner un logo.");return}const t=new FormData;t.append("nom",s.nom),s.logoFile&&t.append("logo",s.logoFile),console.log("Contenu du FormData envoyé :");for(let r of t.entries())console.log(`${r[0]}:`,r[1]);try{i(!0);let r;d?r=await fetch(`https://cl-back.onrender.com/brands/${y}`,{method:"PATCH",body:t}):r=await fetch("https://cl-back.onrender.com/brands",{method:"POST",body:t});const m=await r.json();if(console.log("Réponse du serveur:",m),!r.ok)throw new Error(m.message||"Erreur lors de la soumission du formulaire");c({nom:"",logoFile:null}),u(null),j(!1),E(null),S()}catch(r){console.error("handleSubmit error:",r),x(r.message)}finally{i(!1)}},k=async e=>{if(window.confirm("Voulez-vous vraiment supprimer cette marque ?"))try{i(!0);const t=await fetch(`https://cl-back.onrender.com/brands/${e}`,{method:"DELETE"}),r=await t.json();if(console.log("Réponse de la suppression:",r),!t.ok)throw new Error(r.message||"Erreur lors de la suppression");S()}catch(t){console.error("handleDelete error:",t),x(t.message)}finally{i(!1)}},M=e=>{if(j(!0),E(e.id),c({nom:e.nom,logoFile:null}),e.logo){const t=e.logo.startsWith("data:image/")?e.logo:`data:image/jpeg;base64,${e.logo}`;u(t)}else u(null)},q=()=>{j(!1),E(null),c({nom:"",logoFile:null}),u(null)},L=a.filter(e=>e.nom&&e.nom.toLowerCase().includes(v.toLowerCase()));return o.jsxs(R,{maxWidth:"lg",sx:{py:{xs:2,md:4},px:{xs:2,md:4}},children:[o.jsx(g,{variant:"h4",align:"center",gutterBottom:!0,sx:{color:"#2E7D32",fontSize:{xs:"1.5rem",md:"2.5rem"}},children:d?"Modifier la Marque":"Ajouter une Marque"}),C&&o.jsx(W,{severity:"error",sx:{mb:2},children:C}),o.jsx(f,{component:"form",onSubmit:B,sx:{mb:4,p:{xs:2,md:3},border:"1px solid #A5D6A7",borderRadius:2,backgroundColor:"#f1f8e9"},children:o.jsxs(l,{container:!0,spacing:2,children:[o.jsx(l,{item:!0,xs:12,sm:8,children:o.jsx(w,{label:"Nom",name:"nom",value:s.nom,onChange:z,required:!0,fullWidth:!0,sx:{fontSize:{xs:"0.9rem",md:"1rem"}}})}),o.jsx(l,{item:!0,xs:12,sm:4,children:o.jsxs(h,{variant:"contained",component:"label",fullWidth:!0,sx:{bgcolor:"#2E7D32","&:hover":{bgcolor:"#1B5E20"},fontSize:{xs:"0.8rem",md:"1rem"}},children:[d?"Changer le Logo":"Télécharger le Logo",o.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:A})]})}),b&&o.jsx(l,{item:!0,xs:12,children:o.jsxs(f,{sx:{textAlign:"center"},children:[o.jsx(g,{variant:"subtitle1",sx:{mb:1},children:"Aperçu du Logo :"}),o.jsx(f,{component:"img",src:b,alt:"Aperçu du logo",sx:{maxHeight:{xs:150,md:200},maxWidth:"100%",borderRadius:1,boxShadow:2}})]})}),o.jsx(l,{item:!0,xs:12,children:o.jsx(h,{type:"submit",variant:"contained",fullWidth:!0,disabled:p,sx:{bgcolor:"#2E7D32","&:hover":{bgcolor:"#1B5E20"},fontSize:{xs:"0.9rem",md:"1rem"}},children:p?d?"Modification en cours...":"Ajout en cours...":d?"Enregistrer les modifications":"Ajouter la Marque"})}),d&&o.jsx(l,{item:!0,xs:12,children:o.jsx(h,{variant:"outlined",fullWidth:!0,onClick:q,sx:{fontSize:{xs:"0.9rem",md:"1rem"}},children:"Annuler la modification"})})]})}),o.jsx(g,{variant:"h5",gutterBottom:!0,sx:{color:"#2E7D32",fontSize:{xs:"1.2rem",md:"1.5rem"}},children:"Liste des Marques"}),o.jsx(f,{sx:{mb:3,mt:2},children:o.jsx(w,{label:"Rechercher une marque",variant:"outlined",fullWidth:!0,value:v,onChange:e=>F(e.target.value),sx:{fontSize:{xs:"0.9rem",md:"1rem"}}})}),p&&o.jsx(T,{}),o.jsx(l,{container:!0,spacing:2,children:L.map(e=>o.jsx(l,{item:!0,xs:12,sm:6,md:4,children:o.jsxs($,{sx:{borderRadius:2,boxShadow:3},children:[e.logo&&o.jsx(P,{component:"img",image:e.logo,alt:e.nom,sx:{height:{xs:150,md:180},objectFit:"contain",backgroundColor:"#fff"}}),o.jsx(H,{children:o.jsx(g,{variant:"h6",gutterBottom:!0,sx:{color:"#2E7D32",fontSize:{xs:"1rem",md:"1.2rem"}},children:e.nom})}),o.jsxs(I,{children:[o.jsx(h,{size:"small",onClick:()=>M(e),sx:{color:"#2E7D32",fontSize:{xs:"0.8rem",md:"1rem"}},children:"Modifier"}),o.jsx(h,{size:"small",onClick:()=>k(e.id),sx:{color:"#d32f2f",fontSize:{xs:"0.8rem",md:"1rem"}},children:"Supprimer"})]})]})},e.id))})]})};export{V as default};
